
gwon.my {
  handle /mqtt* {
    reverse_proxy gwon-mosquitto:9001 {
      transport http {
        versions 1.1
      }
      header_up Connection {>Connection}
      header_up Upgrade {>Upgrade}
    }
  }

  # 1️⃣ API 요청 (JSON 데이터) -> /api로 시작하는 건 백엔드로
  handle /api* {
    reverse_proxy gwon-backend:8080
  }

  # 2️⃣ 관리자 페이지 (HTML) -> /admin으로 시작하는 건 백엔드로 (원하면 사용)
  handle /admin* {
    reverse_proxy gwon-backend:8080
  }

  # 3️⃣ 웹소켓 -> /ws로 시작하는 건 백엔드로
  handle /ws* {
    reverse_proxy gwon-backend:8080 {
      transport http {
        versions 1.1
      }
      header_up Connection {>Connection}
      header_up Upgrade {>Upgrade}
    }
  }

  # 4️⃣ 나머지 모든 요청 -> 리액트 (Frontend)
  handle {
    reverse_proxy gwon-frontend:3000
  }
}

# move.io.kr
move.io.kr {
  encode zstd gzip
  # ✅ 1️⃣ WebSocket → Spring Boot 백엔드로
  handle /ws* {
    reverse_proxy move-backend:8080 {
      transport http {
        versions 1.1
      }
      header_up Connection {>Connection}
      header_up Upgrade {>Upgrade}
    }
  }

  # ✅ 2️⃣ API 요청 → Spring Boot 백엔드로
  handle /backend* {
    reverse_proxy move-backend:8080
  }

  handle {
      reverse_proxy move-frontend:5173 {
        header_up Host localhost:5173  # ✅ Host 헤더 변경
      }
    }

}

# leegeonyeong.sites
leegeonyeong.site {
  handle /backend* {
    reverse_proxy geon-backend-1:8080
  }

  handle /ws* {
    reverse_proxy geon-backend-1:8080 {
      transport http {
        versions 1.1
      }
      header_up Connection {>Connection}
      header_up Upgrade {>Upgrade}
    }
  }

  handle {
    reverse_proxy geon-frontend-1:3000
  }
}